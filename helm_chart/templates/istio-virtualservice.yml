{{- if .Values.istio.enabled }}
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: app-virtualservice
spec:
  hosts:
  - {{ .Values.istio.hosts.stable | quote }}
  gateways:
  - {{ .Values.istio.gateway.name | quote }}
  http:
  - name: primary
    route:
    - destination:
        host: app-service
        subset: stable
      weight: {{ sub 100 (.Values.istio.canary.weight | int) }}
    - destination:
        host: app-service
        subset: canary
      weight: {{ .Values.istio.canary.weight | int }}
{{- end }}
